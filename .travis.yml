branches:
  except:
    - master
    - production
  only:
    - /^develop(-.*)?$/
language: php
php:
  - 5.5
sudo: required
dist: trusty
env:
  - GH_REF="github.com/akobashikawa/travis-test-dev"
before_install:
  - echo 'before install'
before_script:
  - echo 'before script'
  - pwd
  - ls -a
  - git status
script: phpunit Test.php
after_success:
  - echo 'after success'
  - git status
  - git remote -v
  - git push --force --quiet "https://${GH_TOKEN}@${GH_REF}" production > /dev/null 2>&1
  - scripts/rack --username ${RACK_USER} --api-key ${RACK_KEY} --region ${RACK_REGION} servers instance list | grep new
after_script: echo 'after script'
deploy:
  provider: script
  script: scripts/deploy.sh
  on:
    repo: akobashikawa/travis-test-dev
    branch: develop
